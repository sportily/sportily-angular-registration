(function(){var a;a=angular.module("sportily.registration",["sportily.registration.controller","sportily.registration.directive","sportily.registration.filters","sportily.registration.templates","sportily.registration.forms"])}).call(this),function(){var a,b;b=angular.module("sportily.registration.controller",["sportily.api","sportily.registration.types","sportily.registration.forms"]),a="Please select at least one valid role.",b.controller("SportilyRegistrationCtrl",["$scope","$q","Form","AgeGroups","Competitions","Members","People","Roles","Teams","Types","Users",function(b,c,d,e,f,g,h,i,j,k,l){var m,n,o,p,q,r,s,t,u;return b.user={},b.person={},b.member={season_id:b.seasonId},b.roles=[{type:null}],b.complete=!1,b.types=k,b.typeOptions=_(k).map(function(a,b){return{key:b,label:a.name,index:a.index}}).sortBy("index").value(),b.state={agreement:!1,dateOfBirth:null},b.addRole=function(){return b.roles.push({type:null})},b.removeRole=function(a){return b.roles=b.roles.filter(function(b){return b!==a})},p=function(a){return a.competition_id&&a.type},u=function(){var c;if(c=_.some(b.roles,p),!c)throw a},b.save=function(){return d.isValid(b).then(u).then(t).then(r).then(q).then(s).then(function(){return b.complete=!0})["catch"](d.showErrors(b))},n=function(){var a;return a={season_id:b.seasonId,include:"organisation"},f.getList(a).then(function(a){return b.competitions=a})},m=function(){var a;return a={season_id:b.seasonId},e.getList(a).then(function(a){return b.ageGroups=a})},o=function(){var a;return a={season_id:b.seasonId},j.getList(a).then(function(a){return b.teams=a})},t=function(){return b.user.email?l.post(b.user):c.when({id:null})},r=function(a){return b.person.user_id=a.id,h.post(b.person)},q=function(a){return b.member.person_id=a.id,g.post(b.member)},s=function(a){return b.roles.forEach(function(b){return b.member_id=a.id,i.post(b)})},n(),m(),o(),b.$watch("state.dateOfBirth",function(a){var c,d,e;return d="DD/MM/YYYY",e="YYYY-MM-DD",c=function(){switch(!1){case!(a instanceof Date):return moment(a);default:return moment(a,d,!0)}}(),c.isValid()&&(b.person.date_of_birth=c.format(e)),b.form.date_of_birth.$setValidity("date",c.isValid())})}])}.call(this),function(){var a;a=angular.module("sportily.registration.directive",[]),a.directive("sportilyRegistration",function(){return{restrict:"E",controller:"SportilyRegistrationCtrl",templateUrl:"templates/sportily/registration/form.html",scope:{registrationId:"@registration",seasonId:"@season"}}})}.call(this),function(){var a;a=angular.module("sportily.registration.filters",[]),a.filter("forOrganisation",function(){return function(a,b){return _.filter(a,function(a){return _.some(a.competitions.data,{organisation_id:b})})}}),a.filter("forCompetition",function(){return function(a,b){return _.filter(a,function(a){return _.some(a.competitions.data,{id:b})})}})}.call(this),function(){var a;a=angular.module("sportily.registration.forms",[]),String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)},a.directive("serverError",function(){return{restrict:"A",require:"?ngModel",scope:{model:"=ngModel"},link:function(a,b,c,d){return a.$watch("model",function(){return _.each(d.$error,function(a,b){return b.startsWith("validation.")?d.$setValidity(b,!0):void 0})})}}}),a.directive("errors",function(){return{restrict:"E",require:["^form","^field"],templateUrl:"templates/sportily/registration/errors.html"}}),a.directive("info",function(){return{restrict:"E",require:["^form","^field"],transclude:!0,templateUrl:"templates/sportily/registration/info.html",scope:!0,link:function(a,b,c,d){return a.form=d[0],a.name=d[1].name()}}}),a.directive("field",function(){return{restrict:"E",require:"^form",transclude:!0,templateUrl:"templates/sportily/registration/field.html",scope:{name:"@",label:"@"},link:function(a,b,c,d){return a.form=d,a.displayLabel=function(){switch(a.label){case void 0:return a.name.ucfirst().replace("_"," ");case"empty":return"";case"none":return"";default:return a.label}}()},controller:["$scope",function(a){this.name=function(){return a.name},this.label=function(){return a.label}}]}}),a.factory("Form",function(a,b){return{showErrors:function(b){return function(c){return a.scrollTo(0,0),c.data?(b.error=c.data.error_description,_.each(c.data.validation_messages,function(a,c){return _.each(a,function(a){return b.form[c].$setValidity(a,!1)})})):b.error=c}},isValid:function(a){return a.form.$valid?b.when():b.reject("There are errors in the form.")}}})}.call(this),function(){var a;a=angular.module("sportily.registration.types",[]),a.constant("Types",{player:{index:1,name:"Player",requiresTeam:!0},coach:{index:2,name:"Coach",requiresTeam:!0},manager:{index:3,name:"Manager",requiresTeam:!0},official:{index:4,name:"Non-Bench Official"},committee:{index:5,name:"Regional Committee"},referee:{index:6,name:"Referee"},timekeeper:{index:7,name:"Timekeeper"},player_training:{index:8,name:"Player (Training)",requiresTeam:!0},player_recreational:{index:9,name:"Player (Recreational)",requiresTeam:!0},parent:{index:10,name:"Parent",requiresTeam:!0}})}.call(this),angular.module("sportily.registration.templates",["templates/sportily/registration/errors.html","templates/sportily/registration/field.html","templates/sportily/registration/form.contact.html","templates/sportily/registration/form.html","templates/sportily/registration/form.personal.html","templates/sportily/registration/form.roles.html","templates/sportily/registration/info.html"]),angular.module("templates/sportily/registration/errors.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/registration/errors.html",'<p class="help-block error"\n    ng-if="form[name].$touched || form.$submitted"\n    ng-repeat="(key, value) in form[name].$error"\n    ng-switch="key">\n\n    <!-- client-side -->\n    <span ng-switch-when="date">Dates must be in the dd/mm/yyyy format</span>\n    <span ng-switch-when="email">Invalid email address</span>\n    <span ng-switch-when="required">Required field</span>\n\n    <!-- server-side -->\n    <span ng-switch-when="validation.email">Invalid email address</span>\n    <span ng-switch-when="validation.required">Required field</span>\n    <span ng-switch-when="validation.unique">{{:: label }} is already taken</span>\n\n    <!-- default for any we missed -->\n    <span ng-switch-default>{{:: key }}</span>\n\n</p>\n')}]),angular.module("templates/sportily/registration/field.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/registration/field.html",'<div class="form-group" ng-class="{ \'has-error\': form[name].$invalid && (form[name].$touched || form.$submitted) }">\n    <label for="{{ name }}" ng-if="label != \'none\'">{{ displayLabel }}&nbsp;</label>\n    <ng-transclude></ng-transclude>\n    <errors name="{{ name }}"></errors>\n</div>\n')}]),angular.module("templates/sportily/registration/form.contact.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/registration/form.contact.html",'<h3>Contact Details</h3>\n\n<!-- email address -->\n<field name="email" label="Email address">\n    <input type="email" class="form-control"\n        name="email"\n        ng-model="user.email"\n        required\n        autocomplete="off"\n        server-error>\n    <info>Email address will <em>never</em> be shown publicly.</info>\n</field>\n\n<field name="street_address">\n    <input type="text" class="form-control" name="street_address" ng-model="person.street_address">\n</field>\n\n<div class="form-group">\n    <label for="city">Town/city</label>\n    <input type="text" class="form-control" id="city" ng-model="person.city">\n</div>\n\n<div class="form-group">\n    <label for="province">County/region</label>\n    <input type="text" class="form-control" id="province" ng-model="person.province">\n</div>\n\n<div class="form-group">\n    <label for="postcode">Postcode</label>\n    <input type="text" class="form-control" id="postcode" ng-model="person.postcode">\n</div>\n\n<div class="form-group">\n    <label for="phone_number">Phone number</label>\n    <input type="text" class="form-control" id="phone_number" ng-model="person.phone_number">\n</div>\n\n<div class="form-group">\n    <label for="mobile_number">Mobile number</label>\n    <input type="text" class="form-control" id="mobile_number" ng-model="person.mobile_number">\n</div>\n')}]),angular.module("templates/sportily/registration/form.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/registration/form.html",'<form name="form" novalidate>\n\n    <div class="alert alert-danger" ng-if="error">{{ error }}</div>\n\n    <div ng-if="!complete">\n        <div ng-include="\'templates/sportily/registration/form.personal.html\'"></div>\n        <div ng-include="\'templates/sportily/registration/form.roles.html\'"></div>\n        <div ng-include="\'templates/sportily/registration/form.contact.html\'"></div>\n\n        <field name="agreement" label="none">\n            <label>\n                <input type="checkbox" ng-model="state.agreement">\n                I agree to abide by BIPHA Rules, Byelaws, Code of Conduct and\n                Child Protection Policy.\n            </label>\n        </field>\n\n        <button class="btn btn-primary" ng-click="save()" ng-disabled="!state.agreement">Register</button>\n    </div>\n\n    <div ng-if="complete">\n        <p>Thank you for registering to participate in the 2015-2015 season.\n        We\'ve just sent you a confirmation email containing instructions of how\n        to verify your account to complete the registration process.</p>\n    </div>\n\n</form>\n')}]),angular.module("templates/sportily/registration/form.personal.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/registration/form.personal.html",'<!-- name -->\n<field name="given_name" label="Forename" class="form-group">\n    <input type="text" class="form-control"\n        name="given_name"\n        ng-model="person.given_name"\n        required\n        server-error>\n</field>\n<field name="family_name" label="Surname" class="form-group">\n    <input type="text" class="form-control"\n        name="family_name"\n        ng-model="person.family_name"\n        required\n        server-error>\n</field>\n\n\n<!-- date of birth -->\n<field name="date_of_birth">\n    <input type="text" class="form-control"\n        name="date_of_birth"\n        ng-model="state.dateOfBirth"\n        placeholder="dd/mm/yyyy"\n        required\n        server-error>\n</field>\n\n<!-- medical conditions -->\n<field name="medical_conditions">\n    <input type="text" class="form-control"\n        name="medical_conditions"\n        ng-model="person.medical_conditions"\n        placeholder="e.g. Asthma"\n        server-error>\n    <info>If member has no relevant medical conditions, please indicate \'None\'.</info>\n</field>\n\n<!-- dbs number -->\n<field name="dbs number" label="DBS registration number">\n    <input type="text" class="form-control"\n        name="dbs_number"\n        ng-model="person.dbs_number"\n        server-error>\n    <info>A valid DBS registration is required for all officials aged 16 year or older.</info>\n</field>\n')}]),angular.module("templates/sportily/registration/form.roles.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/registration/form.roles.html",'<h3>League Roles</h3>\n\n<div class="form-inline form-group" ng-repeat="role in roles">\n\n    <label>Role #{{ $index + 1 }}:</label>\n\n    <div class="form-group">\n        <select class="form-control"\n            ng-options="c.id as c.organisation.name for c in competitions"\n            ng-model="role.competition_id">\n            <option value="">Region&hellip;</option>\n        </select>\n    </div>\n\n    <div class="form-group" ng-show="role.competition_id">\n        <select class="form-control"\n            ng-options="type.key as type.label for type in typeOptions"\n            ng-model="role.type">\n            <option value="">Role&hellip;</option>\n        </select>\n    </div>\n\n    <div class="form-group" ng-show="role.competition_id && types[role.type].requiresTeam">\n        <span>for</span>\n        <select class="form-control"\n            ng-options="team.id as team.name + \' (\' + ageGroups.lookup[team.age_group_id].name + \')\' for team in teams|forCompetition:role.competition_id"\n            ng-model="role.team_id">\n            <option value="">Team&hellip;</option>\n        </select>\n    </div>\n\n    <a ng-click="removeRole(role)" ng-if="roles.length > 1">Remove</a>\n\n</div>\n\n<div class="form-group">\n    <a ng-click="addRole()">Add more roles&hellip;</a>\n</div>\n')}]),angular.module("templates/sportily/registration/info.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/registration/info.html",'<p class="help-block" ng-hide="form[name].$invalid && (form[name].$touched || form.$submitted)" ng-transclude></p>\n')}]);
//# sourceMappingURL=sportily.registration.min.js.map